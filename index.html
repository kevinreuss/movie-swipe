<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MovieMatch</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --netflix-red: #ff4d4d;
        --netflix-black: #141414;
        --netflix-dark-gray: #181818;
        --netflix-light-gray: #b3b3b3;
        --netflix-white: #f5f5f1;

        /* Default dark theme variables */
        --background-color: var(--netflix-black);
        --card-background: var(--netflix-dark-gray);
        --text-color: var(--netflix-white);
        --secondary-text-color: var(--netflix-light-gray);
      }

      /* Light theme variables */
      [data-theme="light"] {
        --background-color: #f5f5f5;
        --card-background: #ffffff;
        --text-color: #333333;
        --secondary-text-color: #666666;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Roboto", sans-serif;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        position: relative;
      }

      .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
        position: relative;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.8);
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 100;
      }

      /* Add this to make header respond to theme */
      [data-theme="light"] header {
        background-color: rgba(245, 245, 245, 0.9);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .logo {
        color: var(--netflix-red);
        font-size: 24px;
        font-weight: bold;
      }

      .header-controls {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .nav-tabs {
        display: flex;
        justify-content: space-around;
        background-color: var(--netflix-dark-gray);
        position: fixed;
        bottom: 0;
        width: 100%;
        padding: 10px 0;
        z-index: 100;
      }

      /* Add this to make nav tabs respond to theme */
      [data-theme="light"] .nav-tabs {
        background-color: #ffffff;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      }

      .nav-tab {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--netflix-light-gray);
        text-decoration: none;
        font-size: 12px;
      }

      .nav-tab i {
        font-size: 20px;
        margin-bottom: 5px;
      }

      .nav-tab.active {
        color: var(--netflix-red);
      }

      .swipe-container {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 25px 15px 115px 15px;
        position: relative;
        overflow: hidden;
      }

      .card {
        position: absolute;
        width: 90%;
        max-width: 400px;
        height: 65vh;
        max-height: 600px;
        background-color: var(--card-background);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        touch-action: none;
        transform-origin: center;
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
      }

      .card-image {
        width: 100%;
        height: 45%;
        background-size: cover;
        background-position: center;
        position: relative;
        flex-shrink: 0;
      }

      .card-gradient {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 50%;
        background: linear-gradient(
          to bottom,
          transparent,
          var(--card-background)
        );
      }

      .card-content {
        padding: 15px;
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }

      .card-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .card-year {
        color: var(--secondary-text-color);
        margin-bottom: 10px;
      }

      .card-description {
        font-size: 14px;
        margin-bottom: 15px;
        line-height: 1.4;
        flex: 1;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
      }

      .card-platforms {
        display: none;
      }

      .card-genres {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .genre-tag {
        background-color: rgba(229, 9, 20, 0.2);
        color: var(--netflix-red);
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
      }

      .swipe-actions {
        display: none;
      }

      .swipe-hint {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 100px;
        font-weight: bold;
        opacity: 0;
        z-index: 10;
        text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }

      .hint-like {
        color: #26de81;
        right: 10%;
        left: auto;
      }

      .hint-dislike {
        color: #fd5068;
        left: 10%;
        right: auto;
      }

      .hint-maybe {
        color: #1e90ff;
        top: 10%;
      }

      .lists-container {
        flex: 1;
        padding: 70px 15px 70px 15px;
        overflow-y: auto;
        display: none;
      }

      .list-categories {
        display: flex;
        flex-direction: column;
        gap: 20px;
        height: 100%;
        width: 100%;
      }

      .list-category {
        background-color: var(--card-background);
        border-radius: 10px;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        cursor: pointer;
      }

      .category-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .category-icon {
        font-size: 24px;
      }

      .category-title {
        font-size: 18px;
        font-weight: 500;
      }

      .category-count {
        background-color: var(--netflix-red);
        color: white;
        border-radius: 20px;
        padding: 5px 12px;
        font-size: 14px;
        font-weight: bold;
      }

      .list-detail {
        display: none;
        flex-direction: column;
        height: 100%;
        width: 100%;
      }

      .list-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        gap: 15px;
      }

      .back-button {
        background: none;
        border: none;
        color: var(--text-color);
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
      }

      .list-detail-title {
        font-size: 20px;
        font-weight: 500;
      }

      .list-items {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding-bottom: 70px;
      }

      .list-item {
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        background-color: var(--card-background);
        display: flex;
        flex-direction: column;
        height: auto;
      }

      .list-item-image {
        width: 100%;
        height: 180px;
        background-size: cover;
        background-position: center;
        position: relative;
      }

      .list-item-gradient {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 50%;
        background: linear-gradient(
          to bottom,
          transparent,
          var(--card-background)
        );
      }

      .list-item-content {
        padding: 15px;
        display: flex;
        flex-direction: column;
      }

      .list-item-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
        white-space: normal;
        position: relative;
      }

      .list-item-year {
        color: var(--secondary-text-color);
        margin-bottom: 5px;
        font-size: 14px;
      }

      .list-item-description {
        font-size: 14px;
        margin-bottom: 10px;
        line-height: 1.4;
      }

      .list-item-genres {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
      }

      .list-item-genre {
        background-color: rgba(229, 9, 20, 0.2);
        color: var(--netflix-red);
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 10px;
      }

      .remove-item {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
      }

      .empty-list {
        color: var(--netflix-light-gray);
        text-align: center;
        padding: 20px;
      }

      .no-more-cards {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        text-align: center;
        padding: 20px;
      }

      .no-more-cards i {
        font-size: 50px;
        color: var(--netflix-red);
        margin-bottom: 20px;
      }

      .no-more-cards h2 {
        margin-bottom: 10px;
      }

      .no-more-cards p {
        color: var(--netflix-light-gray);
        margin-bottom: 20px;
      }

      .reset-button {
        background-color: var(--netflix-red);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
      }

      .theme-toggle {
        background: none;
        border: none;
        color: var(--text-color);
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Add these styles for the reaction animation */
      .reaction-animation {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        font-size: 100px;
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .reaction-animation.active {
        animation: pop-reaction 0.7s ease forwards;
      }

      @keyframes pop-reaction {
        0% {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.2);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 0;
        }
      }

      /* Onboarding overlay styles */
      .onboarding-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      [data-theme="light"] .onboarding-overlay {
        background-color: rgba(245, 245, 245, 0.9);
      }

      .onboarding-content {
        background-color: var(--card-background);
        border-radius: 15px;
        padding: 15px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        text-align: center;
      }

      .onboarding-content h2 {
        color: var(--netflix-red);
        margin-bottom: 15px;
        font-size: 24px;
      }

      .onboarding-content h3 {
        margin: 20px 0 15px;
        font-size: 18px;
      }

      .onboarding-intro {
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .swipe-instructions {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin: 25px 0;
      }

      .swipe-instruction {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .swipe-arrow {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
      }

      .swipe-right {
        background-color: rgba(38, 222, 129, 0.2);
        color: #26de81;
      }

      .swipe-left {
        background-color: rgba(253, 80, 104, 0.2);
        color: #fd5068;
      }

      .swipe-up {
        background-color: rgba(30, 144, 255, 0.2);
        color: #1e90ff;
      }

      .swipe-text {
        text-align: left;
        font-size: 16px;
        flex: 1;
      }

      .swipe-text i {
        margin-right: 8px;
      }

      .beta-notice {
        font-style: italic;
        color: var(--secondary-text-color);
        margin: 20px 0;
        font-size: 14px;
      }

      .onboarding-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 25px;
      }

      .onboarding-button {
        padding: 10px 20px;
        border-radius: 5px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        font-size: 16px;
        background-color: var(--card-background);
        color: var(--text-color);
        border: 1px solid var(--secondary-text-color);
      }

      .primary-button {
        background-color: var(--netflix-red);
        color: white;
        border: none;
      }

      /* Feedback section styles */
      .feedback-section {
        margin-top: 30px;
        background-color: var(--card-background);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      }

      .feedback-section h3 {
        font-size: 18px;
        margin-bottom: 15px;
        color: var(--text-color);
        text-align: center;
      }

      .feedback-links {
        display: flex;
        justify-content: space-around;
        gap: 10px;
      }

      .feedback-link {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: var(--text-color);
        padding: 10px;
        border-radius: 8px;
        transition: background-color 0.2s;
        flex: 1;
      }

      .feedback-link:hover {
        background-color: rgba(255, 77, 77, 0.1);
      }

      .feedback-link i {
        font-size: 24px;
        margin-bottom: 8px;
        color: var(--netflix-red);
      }

      .feedback-link span {
        font-size: 14px;
      }

      /* Compact feedback link style */
      .feedback-compact {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background-color: var(--card-background);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        text-decoration: none;
        color: var(--text-color);
        transition: background-color 0.2s;
      }

      .feedback-compact:hover {
        background-color: rgba(255, 77, 77, 0.1);
      }

      .feedback-compact i {
        font-size: 20px;
        color: var(--netflix-red);
      }

      .feedback-compact span {
        font-size: 14px;
      }

      /* Account styles */
      .account-container {
        flex: 1;
        padding: 70px 15px 70px 15px;
        overflow-y: auto;
        flex-direction: column;
      }

      .account-tabs {
        display: flex;
        border-radius: 8px;
        background-color: var(--card-background);
        border: 1px solid var(--netflix-dark-gray);
      }

      .account-tab-btn {
        flex: 1;
        background: none;
        border: none;
        color: var(--text-color);
        padding: 15px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
      }

      .account-tab-btn.active {
        background-color: var(--netflix-red);
        color: white;
      }

      .account-form-container {
        padding: 20px 0;
      }

      .account-form-container h2 {
        margin-bottom: 10px;
        font-size: 24px;
      }

      .account-subtitle {
        color: var(--secondary-text-color);
        margin-bottom: 25px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .form-group input {
        width: 100%;
        padding: 12px;
        border-radius: 5px;
        border: 1px solid var(--netflix-dark-gray);
        background-color: var(--card-background);
        color: var(--text-color);
        font-size: 16px;
      }

      .account-button {
        width: 100%;
        padding: 12px;
        background-color: var(--netflix-red);
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        margin-top: 10px;
      }

      .error-message {
        color: var(--netflix-red);
        margin-top: 15px;
        font-size: 14px;
      }

      /* User profile section for when logged in */
      .user-profile {
        display: none;
        padding: 20px 0;
      }

      .user-email {
        font-size: 18px;
        margin-bottom: 20px;
      }

      .logout-button {
        background-color: transparent;
        border: 1px solid var(--netflix-red);
        color: var(--netflix-red);
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
      }

      /* Add these styles for the auth status message */
      .auth-status {
        text-align: center;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        font-weight: 500;
        display: none;
      }

      .auth-status.success {
        background-color: rgba(38, 222, 129, 0.2);
        color: #26de81;
        display: block;
      }

      .auth-status.error {
        background-color: rgba(253, 80, 104, 0.2);
        color: #fd5068;
        display: block;
      }

      /* Login reminder banner styles */
      .login-reminder-banner {
        background-color: rgba(255, 77, 77, 0.9);
        color: white;
        padding: 10px 15px;
        font-size: 14px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 101;
        cursor: pointer;
        display: none; /* Hidden by default, will be shown via JS */
        justify-content: center;
      }

      .login-reminder-banner .close-banner {
        background: none;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        padding: 0 5px;
      }

      /* Adjust header position when banner is visible */
      .banner-visible header {
        top: 38px;
      }

      /* Adjust swipe container padding when banner is visible */
      .banner-visible .swipe-container {
        padding-top: 63px;
      }

      /* Adjust lists container padding when banner is visible */
      .banner-visible .lists-container,
      .banner-visible .account-container {
        padding-top: 108px;
      }

      /* Legal Modal Styles */
      .legal-modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
      }

      .legal-modal-content {
        background-color: var(--card-background);
        margin: 15% auto;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
      }

      .close-legal-modal {
        color: var(--secondary-text-color);
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .legal-section {
        margin-bottom: 20px;
      }

      .legal-section h3 {
        color: var(--netflix-red);
        margin-bottom: 10px;
        font-size: 18px;
      }

      .legal-section p,
      .legal-section ul {
        font-size: 14px;
        line-height: 1.5;
        color: var(--text-color);
      }

      .legal-section ul {
        margin-left: 20px;
        margin-bottom: 10px;
      }

      .legal-link {
        color: var(--netflix-red);
        text-decoration: underline;
        cursor: pointer;
        font-size: 14px;
        display: inline-block;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
      // Firebase-Konfiguration (ersetze dies mit deinen eigenen Werten aus der Firebase-Konsole)
      const firebaseConfig = {
        apiKey: "AIzaSyDaSlnEwu9_J2e4dYX5pfQRKYCJlVIq_tw",
        authDomain: "moviematch-cec26.firebaseapp.com",
        projectId: "moviematch-cec26",
        storageBucket: "moviematch-cec26.firebaseapp.com",
        messagingSenderId: "796724064530",
        appId: "1:796724064530:web:d9e333466912a4b42603cb",
        measurementId: "G-7G3JD147DH",
      };

      // Firebase initialisieren
      firebase.initializeApp(firebaseConfig);
    </script>

    <div class="app-container">
      <!-- Add login reminder banner -->
      <div id="loginReminderBanner" class="login-reminder-banner">
        <span>Login to load/store your lists permanently</span>
      </div>

      <header>
        <div class="logo">MovieMatch</div>
        <div class="header-controls">
          <button id="themeToggle" class="theme-toggle">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </header>

      <!-- Add the onboarding overlay -->
      <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-content">
          <h2>Welcome to MovieMatch!</h2>
          <p class="onboarding-intro">
            Find movies and series you'll love:
            <!-- <ul style="text-align: left; margin-top: 10px; margin-left: 20px;">
              <li>Over 1,000 titles in our collection</li>
              <li>More being added regularly</li>
            </ul> -->
          </p>

          <h3>How to use MovieMatch:</h3>

          <div class="swipe-instructions">
            <div class="swipe-instruction">
              <div class="swipe-arrow swipe-right">
                <i class="fas fa-arrow-right"></i>
              </div>
              <div class="swipe-text">Swipe right: <b>Want to watch</b></div>
            </div>

            <div class="swipe-instruction">
              <div class="swipe-arrow swipe-left">
                <i class="fas fa-arrow-left"></i>
              </div>
              <div class="swipe-text">
                Swipe left: <b>Don't want to watch / already watched</b>
              </div>
            </div>

            <div class="swipe-instruction">
              <div class="swipe-arrow swipe-up">
                <i class="fas fa-arrow-up"></i>
              </div>
              <div class="swipe-text">
                Swipe up: <b>Not sure, ask me later</b>
              </div>
            </div>
          </div>

          <p class="beta-notice">
            This is a VERY early version. We'd love to hear your feedback and
            ideas!
          </p>

          <div class="onboarding-buttons">
            <button id="onboardingOk" class="onboarding-button">OK</button>
            <button
              id="onboardingDontShow"
              class="onboarding-button primary-button"
            >
              OK, Don't Show Again
            </button>
          </div>
        </div>
      </div>

      <div
        class="account-container"
        id="accountContainer"
        style="display: none"
      >
        <div id="authStatus" class="auth-status"></div>
        <div class="account-tabs">
          <button class="account-tab-btn active" id="loginTabBtn">Login</button>
          <button class="account-tab-btn" id="registerTabBtn">Register</button>
        </div>

        <div class="user-profile" id="userProfile">
          <h2>Your Account</h2>
          <p class="account-subtitle">Manage your MovieMatch account</p>
          <p class="user-email" id="userEmail"></p>
          <button id="logoutButton" class="logout-button">Sign Out</button>
        </div>

        <div class="account-form-container" id="loginForm">
          <h2>Login to your account</h2>
          <p class="account-subtitle">
            Sign in to store your movie lists securely
          </p>

          <div class="form-group">
            <label for="loginEmail">Email</label>
            <input
              type="email"
              id="loginEmail"
              placeholder="your@email.com"
              required
            />
          </div>

          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input
              type="password"
              id="loginPassword"
              placeholder="Your password"
              required
            />
          </div>

          <button id="loginButton" class="account-button">Sign In</button>
          <p id="loginError" class="error-message"></p>
        </div>

        <div
          class="account-form-container"
          id="registerForm"
          style="display: none"
        >
          <h2>Create an account</h2>
          <p class="account-subtitle">
            Register to store your movie lists securely
          </p>

          <div class="form-group">
            <label for="registerEmail">Email</label>
            <input
              type="email"
              id="registerEmail"
              placeholder="your@email.com"
              required
            />
          </div>

          <div class="form-group">
            <label for="registerPassword">Password</label>
            <input
              type="password"
              id="registerPassword"
              placeholder="Choose a password"
              required
            />
          </div>

          <button id="registerButton" class="account-button">
            Create Account
          </button>
          <p id="registerError" class="error-message"></p>
        </div>
      </div>

      <div class="swipe-container" id="swipeContainer">
        <!-- Add reaction animation elements -->
        <div class="reaction-animation" id="likeReaction">👍</div>
        <div class="reaction-animation" id="dislikeReaction">👎</div>
        <div class="reaction-animation" id="maybeReaction">🤔</div>

        <div class="no-more-cards">
          <i class="fas fa-film"></i>
          <h2>Keine weiteren Filme</h2>
          <p>Du hast alle verfügbaren Filme und Serien bewertet!</p>
          <button class="reset-button" id="resetButton">
            Von vorne beginnen
          </button>
        </div>

        <!-- Cards will be added here dynamically -->
      </div>

      <div class="lists-container" id="listsContainer">
        <div class="list-categories" id="listCategories">
          <div class="list-category" data-list="liked">
            <div class="category-info">
              <div class="category-icon">👍</div>
              <div class="category-title">Want to watch</div>
            </div>
            <div class="category-count" id="likedCount">0</div>
          </div>

          <div class="list-category" data-list="disliked">
            <div class="category-info">
              <div class="category-icon">👎</div>
              <div class="category-title">Don't want to watch</div>
            </div>
            <div class="category-count" id="dislikedCount">0</div>
          </div>

          <!-- Add compact feedback section -->
          <a
            href="https://docs.google.com/forms/d/e/1FAIpQLSd0r3n39BChksWl3TOT2Ingzz1Xns0hNZwuLBA0jPVOEJhXNw/viewform"
            target="_blank"
            class="feedback-compact"
          >
            <i class="fas fa-comment-dots"></i>
            <span>Send feedback or report bugs</span>
          </a>
        </div>

        <div class="list-detail" id="likedDetail">
          <div class="list-header">
            <button class="back-button" data-list="liked">
              <i class="fas fa-arrow-left"></i>
            </button>
            <div class="list-detail-title">👍 Want to watch</div>
          </div>
          <div class="list-items" id="likedList">
            <div class="empty-list">nothing here yet</div>
          </div>
        </div>

        <div class="list-detail" id="dislikedDetail">
          <div class="list-header">
            <button class="back-button" data-list="disliked">
              <i class="fas fa-arrow-left"></i>
            </button>
            <div class="list-detail-title">👎 Don't want to watch</div>
          </div>
          <div class="list-items" id="dislikedList">
            <div class="empty-list">nothing here yet</div>
          </div>
        </div>
      </div>

      <nav class="nav-tabs">
        <a href="#" class="nav-tab" id="accountTab">
          <i class="fas fa-user"></i>
          <span>Account</span>
        </a>
        <a href="#" class="nav-tab active" id="swipeTab">
          <i class="fas fa-film"></i>
          <span>Explore</span>
        </a>
        <a href="#" class="nav-tab" id="listsTab">
          <i class="fas fa-list"></i>
          <span>My Lists</span>
        </a>
      </nav>
    </div>

    <!-- Add this to your HTML, just before the closing </body> tag -->
    <div id="legalModal" class="legal-modal">
      <div class="legal-modal-content">
        <span class="close-legal-modal">&times;</span>
        <h2>Legal Information</h2>

        <div class="legal-section">
          <h3>Information according to § 5 TMG</h3>
          <p>
            Kevin Reuß<br />
            08485 Lengenfeld<br />
            Germany
          </p>
        </div>

        <div class="legal-section">
          <h3>Contact</h3>
          <p>Email: kevreuss@gmail.com</p>
        </div>

        <div class="legal-section">
          <h3>Data Privacy</h3>
          <p>MovieMatch stores the following data:</p>
          <ul>
            <li>Email address (for registered users)</li>
            <li>Movie preferences (liked/disliked movies)</li>
          </ul>
          <p>
            This data is stored using Firebase services. You can request
            deletion of your data by contacting us.
          </p>
        </div>

        <div class="legal-section">
          <h3>Third-Party Services</h3>
          <p>
            This app uses Google Firebase for authentication and data storage.
          </p>
        </div>
      </div>
    </div>

    <script src="mediaData.js"></script>

    <script>
      // Lists to store user choices (now storing IDs instead of full media objects)
      let movieMatch_likedMediaIds = [];
      let movieMatch_dislikedMediaIds = [];
      let currentQueue = []; // Queue of media to show
      let activeCards = [];

      // DOM Elements
      const swipeContainer = document.getElementById("swipeContainer");
      const listsContainer = document.getElementById("listsContainer");
      const swipeTab = document.getElementById("swipeTab");
      const listsTab = document.getElementById("listsTab");
      const likedList = document.getElementById("likedList");
      const dislikedList = document.getElementById("dislikedList");
      const resetButton = document.getElementById("resetButton");
      let noMoreCards = document.querySelector(".no-more-cards");
      const themeToggle = document.getElementById("themeToggle");
      const onboardingOverlay = document.getElementById("onboardingOverlay");
      const onboardingOkBtn = document.getElementById("onboardingOk");
      const onboardingDontShowBtn =
        document.getElementById("onboardingDontShow");
      const accountTab = document.getElementById("accountTab");
      const accountContainer = document.getElementById("accountContainer");
      const loginTabBtn = document.getElementById("loginTabBtn");
      const registerTabBtn = document.getElementById("registerTabBtn");
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");

      // Add references to reaction elements
      let likeReaction = document.getElementById("likeReaction");
      let dislikeReaction = document.getElementById("dislikeReaction");
      let maybeReaction = document.getElementById("maybeReaction");

      // Load saved lists from localStorage
      function loadSavedLists() {
        const savedLikedIds = localStorage.getItem("movieMatch_likedMediaIds");
        const savedDislikedIds = localStorage.getItem(
          "movieMatch_dislikedMediaIds"
        );

        if (savedLikedIds) {
          movieMatch_likedMediaIds = JSON.parse(savedLikedIds);
        }

        if (savedDislikedIds) {
          movieMatch_dislikedMediaIds = JSON.parse(savedDislikedIds);
        }
      }

      // Save lists to localStorage
      function saveLists() {
        localStorage.setItem(
          "movieMatch_likedMediaIds",
          JSON.stringify(movieMatch_likedMediaIds)
        );
        localStorage.setItem(
          "movieMatch_dislikedMediaIds",
          JSON.stringify(movieMatch_dislikedMediaIds)
        );
      }

      // Theme handling
      function initTheme() {
        // Check if user has previously set a theme preference
        const savedTheme = localStorage.getItem("movieMatch_theme");

        if (savedTheme) {
          // Apply saved theme
          document.documentElement.setAttribute("data-theme", savedTheme);
          updateThemeIcon(savedTheme);
        } else {
          // Check system preference
          if (
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: light)").matches
          ) {
            document.documentElement.setAttribute("data-theme", "light");
            updateThemeIcon("light");
          } else {
            document.documentElement.setAttribute("data-theme", "dark");
            updateThemeIcon("dark");
          }
        }

        // Add event listener for theme toggle
        themeToggle.addEventListener("click", toggleTheme);

        // Listen for system theme changes
        window
          .matchMedia("(prefers-color-scheme: light)")
          .addEventListener("change", (e) => {
            // Only apply system changes if user hasn't set a preference
            if (!localStorage.getItem("movieMatch_theme")) {
              const newTheme = e.matches ? "light" : "dark";
              document.documentElement.setAttribute("data-theme", newTheme);
              updateThemeIcon(newTheme);
            }
          });
      }

      function toggleTheme() {
        const currentTheme =
          document.documentElement.getAttribute("data-theme") || "dark";
        const newTheme = currentTheme === "dark" ? "light" : "dark";

        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("movieMatch_theme", newTheme);
        updateThemeIcon(newTheme);
      }

      function updateThemeIcon(theme) {
        if (theme === "dark") {
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
          themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
      }

      // Initialize the app
      function initApp() {
        // Get DOM elements
        const accountTab = document.getElementById("accountTab");
        const accountContainer = document.getElementById("accountContainer");
        const loginTabBtn = document.getElementById("loginTabBtn");
        const registerTabBtn = document.getElementById("registerTabBtn");
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const loginReminderBanner = document.getElementById(
          "loginReminderBanner"
        );

        // Initialize theme
        initTheme();

        // Check if onboarding should be shown
        checkOnboarding();

        // Initialize Firebase authentication first
        // This will trigger the auth state change listener which will load the appropriate data
        initAuth();

        // Setup login reminder banner
        setupLoginReminderBanner();

        // Add event listeners for main navigation
        swipeTab.addEventListener("click", showSwipeView);
        listsTab.addEventListener("click", showListsView);
        accountTab.addEventListener("click", showAccountView);
        resetButton.addEventListener("click", resetApp);

        // Add event listeners for account tabs
        loginTabBtn.addEventListener("click", function () {
          loginTabBtn.classList.add("active");
          registerTabBtn.classList.remove("active");
          loginForm.style.display = "block";
          registerForm.style.display = "none";
        });

        registerTabBtn.addEventListener("click", function () {
          registerTabBtn.classList.add("active");
          loginTabBtn.classList.remove("active");
          registerForm.style.display = "block";
          loginForm.style.display = "none";
        });

        // Initialize list handlers
        initListHandlers();

        // Setup legal modal
        setupLegalModal();
      }

      // Add Firebase auth functionality
      function initAuth() {
        const loginButton = document.getElementById("loginButton");
        const registerButton = document.getElementById("registerButton");
        const logoutButton = document.getElementById("logoutButton");
        const loginEmail = document.getElementById("loginEmail");
        const loginPassword = document.getElementById("loginPassword");
        const registerEmail = document.getElementById("registerEmail");
        const registerPassword = document.getElementById("registerPassword");
        const authStatus = document.getElementById("authStatus");
        const userProfile = document.getElementById("userProfile");
        const userEmail = document.getElementById("userEmail");
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");

        // Check if user is already logged in
        firebase.auth().onAuthStateChanged(function (user) {
          if (user) {
            // User is signed in
            userEmail.textContent = user.email;
            userProfile.style.display = "block";
            loginForm.style.display = "none";
            registerForm.style.display = "none";
            document.querySelector(".account-tabs").style.display = "none";

            // Hide login reminder banner
            hideBanner();

            // Load user's lists from Firebase
            loadUserListsFromFirebase(user.uid);
          } else {
            // User is signed out
            userProfile.style.display = "none";
            loginForm.style.display = "block";
            document.querySelector(".account-tabs").style.display = "flex";

            showBanner();

            // Load saved lists from localStorage
            loadSavedLists();

            // Initialize the queue and create cards
            refreshQueue();

            // Create initial cards with a slight delay to ensure DOM is ready
            setTimeout(() => {
              createCards();
            }, 100);

            // Update lists view with loaded data
            updateLists();
          }
        });

        // Login functionality
        loginButton.addEventListener("click", function () {
          const email = loginEmail.value;
          const password = loginPassword.value;

          if (!email || !password) {
            showAuthMessage("Please enter both email and password", "error");
            return;
          }

          firebase
            .auth()
            .signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
              // Signed in
              showAuthMessage("Login successful!", "success");
              loginEmail.value = "";
              loginPassword.value = "";
              loginError.textContent = "";
            })
            .catch((error) => {
              loginError.textContent = error.message;
              showAuthMessage("Login failed: " + error.message, "error");
            });
        });

        // Register functionality
        registerButton.addEventListener("click", function () {
          const email = registerEmail.value;
          const password = registerPassword.value;

          if (!email || !password) {
            showAuthMessage("Please enter both email and password", "error");
            return;
          }

          if (password.length < 6) {
            showAuthMessage(
              "Password should be at least 6 characters",
              "error"
            );
            return;
          }

          firebase
            .auth()
            .createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
              // Signed up
              showAuthMessage("Account created successfully!", "success");
              registerEmail.value = "";
              registerPassword.value = "";
              registerError.textContent = "";

              // Save local lists to Firebase
              saveLocalListsToFirebase(userCredential.user.uid);
            })
            .catch((error) => {
              registerError.textContent = error.message;
              showAuthMessage("Registration failed: " + error.message, "error");
            });
        });

        // Function to save local lists to Firebase
        function saveLocalListsToFirebase(userId) {
          // Get lists from localStorage
          const savedLikedIds = localStorage.getItem(
            "movieMatch_likedMediaIds"
          );
          const savedDislikedIds = localStorage.getItem(
            "movieMatch_dislikedMediaIds"
          );

          // Create data object to save
          const userData = {
            likedMediaIds: savedLikedIds ? JSON.parse(savedLikedIds) : [],
            dislikedMediaIds: savedDislikedIds
              ? JSON.parse(savedDislikedIds)
              : [],
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          };

          // Save to Firestore
          firebase
            .firestore()
            .collection("users")
            .doc(userId)
            .set(userData)
            .then(() => {
              console.log("Local lists saved to Firebase successfully");

              // Clear local storage after successful save to Firebase
              localStorage.removeItem("movieMatch_likedMediaIds");
              localStorage.removeItem("movieMatch_dislikedMediaIds");
            })
            .catch((error) => {
              console.error("Error saving lists to Firebase: ", error);
            });
        }

        // Logout functionality
        logoutButton.addEventListener("click", function () {
          firebase
            .auth()
            .signOut()
            .then(() => {
              // Clear localStorage
              localStorage.removeItem("movieMatch_likedMediaIds");
              localStorage.removeItem("movieMatch_dislikedMediaIds");

              // Reset in-memory lists
              movieMatch_likedMediaIds = [];
              movieMatch_dislikedMediaIds = [];

              // Refresh UI
              refreshQueue();
              updateLists();

              // If in swipe view, recreate cards
              if (swipeContainer.style.display !== "none") {
                // Clear existing cards and recreate
                swipeContainer.innerHTML = `
                <div class="reaction-animation" id="likeReaction">👍</div>
                <div class="reaction-animation" id="dislikeReaction">👎</div>
                <div class="reaction-animation" id="maybeReaction">🤔</div>
                <div class="no-more-cards">
                  <i class="fas fa-film"></i>
                  <h2>Keine weiteren Filme</h2>
                  <p>Du hast alle verfügbaren Filme und Serien bewertet!</p>
                  <button class="reset-button" id="resetButton">Von vorne beginnen</button>
                </div>
              `;

                // Update reaction element references
                likeReaction = document.getElementById("likeReaction");
                dislikeReaction = document.getElementById("dislikeReaction");
                maybeReaction = document.getElementById("maybeReaction");
                noMoreCards = document.querySelector(".no-more-cards");

                activeCards = [];
                createCards();

                // Re-add event listener to reset button
                document
                  .getElementById("resetButton")
                  .addEventListener("click", resetApp);
              }

              showAuthMessage("Logged out successfully", "success");
            })
            .catch((error) => {
              showAuthMessage("Error signing out: " + error.message, "error");
            });
        });

        // Function to show auth status messages
        function showAuthMessage(message, type) {
          authStatus.textContent = message;
          authStatus.className = "auth-status";
          authStatus.classList.add(type);

          // Hide the message after 5 seconds
          setTimeout(() => {
            authStatus.style.display = "none";
          }, 5000);
        }
      }

      // Function to load user's lists from Firebase
      function loadUserListsFromFirebase(userId) {
        firebase
          .firestore()
          .collection("users")
          .doc(userId)
          .get()
          .then((doc) => {
            if (doc.exists) {
              const userData = doc.data();

              // Update local lists with Firebase data
              if (userData.likedMediaIds) {
                movieMatch_likedMediaIds = userData.likedMediaIds;
              }

              if (userData.dislikedMediaIds) {
                movieMatch_dislikedMediaIds = userData.dislikedMediaIds;
              }

              // Clear localStorage since we're now using Firebase data
              localStorage.removeItem("movieMatch_likedMediaIds");
              localStorage.removeItem("movieMatch_dislikedMediaIds");

              // Refresh the queue and update UI
              refreshQueue();

              // Create initial cards with a slight delay to ensure DOM is ready
              setTimeout(() => {
                // Clear existing cards
                swipeContainer.innerHTML = `
                  <div class="reaction-animation" id="likeReaction">👍</div>
                  <div class="reaction-animation" id="dislikeReaction">👎</div>
                  <div class="reaction-animation" id="maybeReaction">🤔</div>
                  <div class="no-more-cards">
                    <i class="fas fa-film"></i>
                    <h2>Keine weiteren Filme</h2>
                    <p>Du hast alle verfügbaren Filme und Serien bewertet!</p>
                    <button class="reset-button" id="resetButton">Von vorne beginnen</button>
                  </div>
                `;

                // Update reaction element references
                likeReaction = document.getElementById("likeReaction");
                dislikeReaction = document.getElementById("dislikeReaction");
                maybeReaction = document.getElementById("maybeReaction");
                noMoreCards = document.querySelector(".no-more-cards");

                activeCards = [];
                createCards();

                // Re-add event listener to reset button
                document
                  .getElementById("resetButton")
                  .addEventListener("click", resetApp);
              }, 100);

              // Update lists view
              updateLists();

              showAuthMessage("Lists loaded from your account", "success");
            } else {
              console.log("No user data found in Firestore");

              // If no data in Firebase, initialize with empty lists
              movieMatch_likedMediaIds = [];
              movieMatch_dislikedMediaIds = [];

              // Refresh the queue and update UI
              refreshQueue();

              // Create initial cards
              setTimeout(() => {
                createCards();
              }, 100);

              // Update lists view
              updateLists();
            }
          })
          .catch((error) => {
            console.error("Error loading user data:", error);
            showAuthMessage("Error loading your lists", "error");

            // Fallback to localStorage on error
            loadSavedLists();
            refreshQueue();
            setTimeout(() => {
              createCards();
            }, 100);
            updateLists();
          });
      }

      // Refresh the queue of media to show
      function refreshQueue() {
        // Filter out media that's already in liked or disliked lists
        currentQueue = mediaData
          .filter(
            (media) =>
              !movieMatch_likedMediaIds.includes(media.id) &&
              !movieMatch_dislikedMediaIds.includes(media.id)
          )
          // Shuffle the array to randomize order
          .sort(() => Math.random() - 0.5);

        console.log(currentQueue);
        console.log(movieMatch_likedMediaIds);
        console.log(movieMatch_dislikedMediaIds);
        console.log("---");
      }

      // Create cards for swiping
      function createCards() {
        // Create 3 cards (or fewer if we're near the end of the queue)
        const numCards = Math.min(3, currentQueue.length);

        for (let i = 0; i < numCards; i++) {
          if (i < currentQueue.length) {
            const media = currentQueue[i];
            const card = createCard(media, i);
            swipeContainer.appendChild(card);
            activeCards.push(card);

            // Only make the top card draggable
            if (i === 0) {
              makeCardDraggable(card);
            }
          }
        }

        // Show "no more cards" if queue is empty
        if (currentQueue.length === 0) {
          noMoreCards.style.display = "flex";
        } else {
          noMoreCards.style.display = "none";
        }

        // Position cards in a stack
        positionCards();
      }

      // Create a single card element
      function createCard(media, queueIndex) {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = media.id;
        card.dataset.queueIndex = queueIndex;

        const genresHTML = media.genres
          .map((genre) => `<div class="genre-tag">${genre}</div>`)
          .join("");

        card.innerHTML = `
          <div class="card-image" style="background-image: url('${media.image}')">
            <div class="card-gradient"></div>
          </div>
          <div class="card-content">
            <div class="card-title">${media.title}</div>
            <div class="card-year">${media.type} • ${media.year}</div>
            <div class="card-description">${media.description}</div>
            <div class="card-genres">${genresHTML}</div>
          </div>
        `;

        return card;
      }

      // Position cards in a stack
      function positionCards() {
        activeCards.forEach((card, index) => {
          card.style.zIndex = 10 - index;
          card.style.transform = `scale(${1 - index * 0.05}) translateY(${
            index * 10
          }px)`;
          card.style.opacity = index === 0 ? "1" : "0.8";
        });
      }

      // Make a card draggable
      function makeCardDraggable(card) {
        let startX, startY, initialX, initialY;
        let isDragging = false;

        // Touch events
        card.addEventListener("touchstart", dragStart, { passive: false });
        card.addEventListener("touchmove", drag, { passive: false });
        card.addEventListener("touchend", dragEnd, { passive: false });

        // Mouse events
        card.addEventListener("mousedown", dragStart);
        card.addEventListener("mousemove", drag);
        card.addEventListener("mouseup", dragEnd);
        card.addEventListener("mouseleave", dragEnd);

        function dragStart(e) {
          e.preventDefault();

          if (e.type === "touchstart") {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
          } else {
            startX = e.clientX;
            startY = e.clientY;
          }

          initialX = card.getBoundingClientRect().left;
          initialY = card.getBoundingClientRect().top;
          isDragging = true;
        }

        function drag(e) {
          if (!isDragging) return;
          e.preventDefault();

          let currentX, currentY;

          if (e.type === "touchmove") {
            currentX = e.touches[0].clientX;
            currentY = e.touches[0].clientY;
          } else {
            currentX = e.clientX;
            currentY = e.clientY;
          }

          const diffX = currentX - startX;
          const diffY = currentY - startY;

          card.style.transform = `translate(${diffX}px, ${diffY}px) rotate(${
            diffX * 0.1
          }deg)`;
        }

        function dragEnd(e) {
          if (!isDragging) return;
          isDragging = false;

          let currentX, currentY;

          if (e.type === "touchend") {
            currentX = e.changedTouches[0].clientX;
            currentY = e.changedTouches[0].clientY;
          } else {
            currentX = e.clientX;
            currentY = e.clientY;
          }

          const diffX = currentX - startX;
          const diffY = currentY - startY;

          // Determine swipe direction based on distance
          if (diffX > 100) {
            // Swipe right (like)
            card.style.transform = `translate(${window.innerWidth}px, ${diffY}px) rotate(30deg)`;
            setTimeout(() => {
              handleSwipe("like");
            }, 200);
          } else if (diffX < -100) {
            // Swipe left (dislike)
            card.style.transform = `translate(-${window.innerWidth}px, ${diffY}px) rotate(-30deg)`;
            setTimeout(() => {
              handleSwipe("dislike");
            }, 200);
          } else if (diffY < -100) {
            // Swipe up (maybe)
            card.style.transform = `translate(${diffX}px, -${
              window.innerHeight
            }px) rotate(${diffX * 0.1}deg)`;
            setTimeout(() => {
              handleSwipe("maybe");
            }, 200);
          } else {
            // Reset position if not swiped far enough
            card.style.transform = "translate(0, 0) rotate(0)";
          }
        }
      }

      // Handle swipe action
      function handleSwipe(action) {
        if (activeCards.length === 0) return;

        const card = activeCards[0];
        const mediaId = card.dataset.id;
        const media = mediaData.find((m) => m.id == mediaId);

        // Handle based on action
        if (action === "like") {
          movieMatch_likedMediaIds.push(mediaId);
          card.style.transform = "translate(100vw, 0) rotate(30deg)";
          showReaction(likeReaction);
          saveUserLists(); // Replace saveLists() with saveUserLists()
        } else if (action === "dislike") {
          movieMatch_dislikedMediaIds.push(mediaId);
          card.style.transform = "translate(-100vw, 0) rotate(-30deg)";
          showReaction(dislikeReaction);
          saveUserLists(); // Replace saveLists() with saveUserLists()
        } else if (action === "maybe") {
          // Move this item to the end of the queue for later
          currentQueue.push(media);
          card.style.transform = "translate(0, -100vh)";
          showReaction(maybeReaction);
        }

        // Remove card after animation
        setTimeout(() => {
          card.remove();
          activeCards.shift();
          currentQueue.shift();

          // Check if we need to add more cards
          if (
            activeCards.length < 3 &&
            activeCards.length < currentQueue.length
          ) {
            const newQueueIndex = activeCards.length;
            const newMedia = currentQueue[newQueueIndex];
            const newCard = createCard(newMedia, newQueueIndex);
            swipeContainer.appendChild(newCard);
            activeCards.push(newCard);
          }

          // Reposition remaining cards
          positionCards();

          // Make the top card draggable
          if (activeCards.length > 0) {
            makeCardDraggable(activeCards[0]);
          }

          // Check if we've reached the end
          if (currentQueue.length === 0) {
            noMoreCards.style.display = "flex";
          }

          // Update lists view
          updateLists();
        }, 300);
      }

      // Function to show reaction animation
      function showReaction(reactionElement) {
        reactionElement.classList.add("active");

        // Remove the active class after animation completes
        setTimeout(() => {
          reactionElement.classList.remove("active");
        }, 700);
      }

      // Update the lists view
      function updateLists() {
        // Update counts
        document.getElementById("likedCount").textContent =
          movieMatch_likedMediaIds.length;
        document.getElementById("dislikedCount").textContent =
          movieMatch_dislikedMediaIds.length;

        // Update liked list
        if (movieMatch_likedMediaIds.length > 0) {
          likedList.innerHTML = movieMatch_likedMediaIds
            .map((id, index) => {
              const media = mediaData.find((m) => m.id == id);
              return createListItem(media, "liked", index);
            })
            .join("");
        } else {
          likedList.innerHTML =
            '<div class="empty-list">Nothing here yet</div>';
        }

        // Update disliked list
        if (movieMatch_dislikedMediaIds.length > 0) {
          dislikedList.innerHTML = movieMatch_dislikedMediaIds
            .map((id, index) => {
              const media = mediaData.find((m) => m.id == id);
              return createListItem(media, "disliked", index);
            })
            .join("");
        } else {
          dislikedList.innerHTML =
            '<div class="empty-list">Nothing here yet</div>';
        }
      }

      // Create a list item for the lists view
      function createListItem(media, listType, index) {
        const genresHTML = media.genres
          .map((genre) => `<div class="list-item-genre">${genre}</div>`)
          .join("");

        return `
          <div class="list-item">
            <div class="list-item-image" style="background-image: url('${media.image}')">
              <div class="list-item-gradient"></div>
            </div>
            <div class="list-item-content">
              <div class="list-item-title">${media.title}</div>
              <div class="list-item-year">${media.type} • ${media.year}</div>
              <div class="list-item-description">${media.description}</div>
              <div class="list-item-genres">${genresHTML}</div>
            </div>
            <button class="remove-item" data-list="${listType}" data-index="${index}">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;
      }

      // Reset the app
      function resetApp() {
        // Clear all cards
        swipeContainer.innerHTML = `
          <div class="reaction-animation" id="likeReaction">👍</div>
          <div class="reaction-animation" id="dislikeReaction">👎</div>
          <div class="reaction-animation" id="maybeReaction">🤔</div>
          <div class="no-more-cards">
            <i class="fas fa-film"></i>
            <h2>Keine weiteren Filme</h2>
            <p>Du hast alle verfügbaren Filme und Serien bewertet!</p>
            <button class="reset-button" id="resetButton">Von vorne beginnen</button>
          </div>
        `;

        // Update reaction element references after rebuilding DOM
        likeReaction = document.getElementById("likeReaction");
        dislikeReaction = document.getElementById("dislikeReaction");
        maybeReaction = document.getElementById("maybeReaction");

        // Reset variables
        movieMatch_likedMediaIds = [];
        movieMatch_dislikedMediaIds = [];
        activeCards = [];

        // Clear localStorage for lists
        localStorage.removeItem("movieMatch_likedMediaIds");
        localStorage.removeItem("movieMatch_dislikedMediaIds");

        // Refresh the queue
        refreshQueue();

        // Hide no more cards message
        noMoreCards = document.querySelector(".no-more-cards");
        noMoreCards.style.display = "none";

        // Create new cards
        createCards();

        // Update lists
        updateLists();

        // Add event listener to new reset button
        document
          .getElementById("resetButton")
          .addEventListener("click", resetApp);

        // Switch to swipe view
        swipeTab.click();
      }

      // Show swipe view
      function showSwipeView() {
        // Refresh the queue when returning to swipe view
        refreshQueue();

        // Clear existing cards
        swipeContainer.innerHTML = `
          <div class="reaction-animation" id="likeReaction">👍</div>
          <div class="reaction-animation" id="dislikeReaction">👎</div>
          <div class="reaction-animation" id="maybeReaction">🤔</div>
          <div class="no-more-cards">
            <i class="fas fa-film"></i>
            <h2>Keine weiteren Filme</h2>
            <p>Du hast alle verfügbaren Filme und Serien bewertet!</p>
            <button class="reset-button" id="resetButton">Von vorne beginnen</button>
          </div>
        `;

        // Update reaction element references after rebuilding DOM
        likeReaction = document.getElementById("likeReaction");
        dislikeReaction = document.getElementById("dislikeReaction");
        maybeReaction = document.getElementById("maybeReaction");

        activeCards = [];

        // Create new cards
        createCards();

        // Update UI
        swipeContainer.style.display = "flex";
        listsContainer.style.display = "none";
        accountContainer.style.display = "none";
        swipeTab.classList.add("active");
        listsTab.classList.remove("active");
        accountTab.classList.remove("active");

        // Re-add event listener to reset button
        document
          .getElementById("resetButton")
          .addEventListener("click", resetApp);
      }

      // Show lists view
      function showListsView() {
        swipeContainer.style.display = "none";
        listsContainer.style.display = "flex";
        accountContainer.style.display = "none";
        document.getElementById("listCategories").style.display = "flex";
        document.getElementById("likedDetail").style.display = "none";
        document.getElementById("dislikedDetail").style.display = "none";
        swipeTab.classList.remove("active");
        listsTab.classList.add("active");
        accountTab.classList.remove("active");
      }

      // Add a new function to show account view
      function showAccountView() {
        swipeContainer.style.display = "none";
        listsContainer.style.display = "none";
        accountContainer.style.display = "flex";

        // Update active tab
        swipeTab.classList.remove("active");
        listsTab.classList.remove("active");
        accountTab.classList.add("active");
      }

      // Add these functions to handle list navigation and item removal
      function initListHandlers() {
        // Category click handlers
        document.querySelectorAll(".list-category").forEach((category) => {
          category.addEventListener("click", function () {
            const listType = this.dataset.list;
            document.getElementById("listCategories").style.display = "none";
            document.getElementById(`${listType}Detail`).style.display = "flex";
          });
        });

        // Back button handlers
        document.querySelectorAll(".back-button").forEach((button) => {
          button.addEventListener("click", function () {
            const listType = this.dataset.list;
            document.getElementById(`${listType}Detail`).style.display = "none";
            document.getElementById("listCategories").style.display = "flex";
          });
        });

        // Set up event delegation for remove buttons
        listsContainer.addEventListener("click", function (e) {
          if (e.target.closest(".remove-item")) {
            const button = e.target.closest(".remove-item");
            const listType = button.dataset.list;
            const index = parseInt(button.dataset.index);

            // Remove the item from the appropriate list
            if (listType === "liked") {
              movieMatch_likedMediaIds.splice(index, 1);
            } else if (listType === "disliked") {
              movieMatch_dislikedMediaIds.splice(index, 1);
            }

            // Save changes using the new function
            saveUserLists();

            // Refresh the queue to include newly removed items
            refreshQueue();

            // Update the lists
            updateLists();
          }
        });
      }

      // Check if onboarding should be shown
      function checkOnboarding() {
        const onboardingDismissed = localStorage.getItem(
          "movieMatch_onboardingDismissed"
        );

        if (onboardingDismissed === "true") {
          onboardingOverlay.style.display = "none";
        } else {
          onboardingOverlay.style.display = "flex";

          // Add event listeners for onboarding buttons
          onboardingOkBtn.addEventListener("click", () => {
            onboardingOverlay.style.display = "none";
          });

          onboardingDontShowBtn.addEventListener("click", () => {
            localStorage.setItem("movieMatch_onboardingDismissed", "true");
            onboardingOverlay.style.display = "none";
          });
        }
      }

      // Function to setup login reminder banner
      function setupLoginReminderBanner() {
        const loginReminderBanner = document.getElementById(
          "loginReminderBanner"
        );
        const closeBannerBtn = document.querySelector(".close-banner");

        // Add click event to the banner to navigate to account tab
        loginReminderBanner.addEventListener("click", function (e) {
          // Don't trigger if clicking the close button
          if (!e.target.closest(".close-banner")) {
            showAccountView();
          }
        });

        // Check auth state to show/hide banner
        firebase.auth().onAuthStateChanged(function (user) {
          if (!user) {
            showBanner();
          } else {
            hideBanner();
          }
        });
      }

      // Function to show the login reminder banner
      function showBanner() {
        const loginReminderBanner = document.getElementById(
          "loginReminderBanner"
        );
        loginReminderBanner.style.display = "flex";
        document.body.classList.add("banner-visible");
      }

      // Function to hide the login reminder banner
      function hideBanner() {
        const loginReminderBanner = document.getElementById(
          "loginReminderBanner"
        );
        loginReminderBanner.style.display = "none";
        document.body.classList.remove("banner-visible");
      }

      // Add this new function to save lists based on auth state
      function saveUserLists() {
        // Check if user is logged in
        const user = firebase.auth().currentUser;

        if (user) {
          // User is logged in, save to Firebase
          const userData = {
            likedMediaIds: movieMatch_likedMediaIds,
            dislikedMediaIds: movieMatch_dislikedMediaIds,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          };

          firebase
            .firestore()
            .collection("users")
            .doc(user.uid)
            .set(userData)
            .then(() => {
              console.log("Lists saved to Firebase successfully");
            })
            .catch((error) => {
              console.error("Error saving lists to Firebase: ", error);
              // Fallback to localStorage if Firebase save fails
              saveLists();
            });
        } else {
          // User is not logged in, save to localStorage
          saveLists();
        }
      }

      // Function to setup the legal modal
      function setupLegalModal() {
        // Add legal link to login and register forms
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");

        // Add legal link to login form
        const loginLegalLink = document.createElement("a");
        loginLegalLink.className = "legal-link";
        loginLegalLink.textContent = "Legal Information";
        loginLegalLink.onclick = openLegalModal;
        loginForm.appendChild(loginLegalLink);

        // Add legal link to register form
        const registerLegalLink = document.createElement("a");
        registerLegalLink.className = "legal-link";
        registerLegalLink.textContent = "Legal Information";
        registerLegalLink.onclick = openLegalModal;
        registerForm.appendChild(registerLegalLink);

        // Get the modal
        const legalModal = document.getElementById("legalModal");

        // Get the <span> element that closes the modal
        const closeBtn =
          document.getElementsByClassName("close-legal-modal")[0];

        // When the user clicks on <span> (x), close the modal
        closeBtn.onclick = function () {
          legalModal.style.display = "none";
        };

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
          if (event.target == legalModal) {
            legalModal.style.display = "none";
          }
        };
      }

      // Function to open the legal modal
      function openLegalModal() {
        const legalModal = document.getElementById("legalModal");
        legalModal.style.display = "block";
      }

      // Initialize the app
      initApp();
    </script>
  </body>
</html>
